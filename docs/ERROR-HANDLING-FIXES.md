# é”™è¯¯å¤„ç†ç³»ç»Ÿä¿®å¤æŠ¥å‘Š

## ä¿®å¤æ¦‚è¿°

æœ¬æ¬¡ä¿®å¤è§£å†³äº†é”™è¯¯å¤„ç†ç³»ç»Ÿä¸å®Œæ•´çš„é—®é¢˜ï¼Œå®ç°äº†ç»Ÿä¸€ã€å®Œæ•´ã€å¯é çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚

## ä¿®å¤å†…å®¹

### 1. æ ¸å¿ƒé”™è¯¯ç®¡ç†å™¨å®Œå–„

#### ä¿®å¤çš„é—®é¢˜ï¼š
- âœ… ä¿®å¤äº† `_retryWithBackoff` æ–¹æ³•ç¼ºå°‘è¿”å›å€¼çš„é—®é¢˜
- âœ… ä¿®å¤äº†é€šçŸ¥ç³»ç»Ÿä¾èµ–ä¸æ˜ç¡®çš„é—®é¢˜
- âœ… ä¿®å¤äº†å·²å¼ƒç”¨çš„ `substr()` æ–¹æ³•
- âœ… ä¿®å¤äº†æœªä½¿ç”¨å˜é‡çš„é—®é¢˜

#### æ”¹è¿›å†…å®¹ï¼š
- ğŸ”§ å®ç°äº†å®Œæ•´çš„æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
- ğŸ”§ æ·»åŠ äº†ä¾èµ–æ³¨å…¥çš„é€šçŸ¥ç³»ç»Ÿ
- ğŸ”§ å®Œå–„äº†é”™è¯¯æ¢å¤æœºåˆ¶
- ğŸ”§ ä¼˜åŒ–äº†é”™è¯¯ç»Ÿè®¡å’Œå†å²è®°å½•ç®¡ç†

### 2. é”™è¯¯å·¥å…·å‡½æ•°ä¼˜åŒ–

#### ä¿®å¤çš„é—®é¢˜ï¼š
- âœ… ä¿®å¤äº† `safeAsync` ä¸­æœªä½¿ç”¨çš„ `lastError` å˜é‡
- âœ… å®Œå–„äº†é”™è¯¯é‡è¯•é€»è¾‘
- âœ… å¢å¼ºäº†APIå¯†é’¥éªŒè¯

#### æ”¹è¿›å†…å®¹ï¼š
- ğŸ”§ å®ç°äº†å®Œæ•´çš„å¼‚æ­¥é”™è¯¯åŒ…è£…å™¨
- ğŸ”§ æ·»åŠ äº†ç½‘ç»œé”™è¯¯åˆ†æå™¨
- ğŸ”§ å®Œå–„äº†æ–‡ä»¶éªŒè¯åŠŸèƒ½
- ğŸ”§ å®ç°äº†æ‰¹é‡é”™è¯¯æ”¶é›†å™¨

### 3. æ¨¡å—é”™è¯¯å¤„ç†å™¨ç»Ÿä¸€

#### ç¿»è¯‘æ¨¡å—é”™è¯¯å¤„ç†å™¨
- âœ… å®ç°äº†ç»Ÿä¸€çš„æ‰¹é‡ç¿»è¯‘é”™è¯¯å¤„ç†
- âœ… æ·»åŠ äº†é‡è¯•ç­–ç•¥å’Œç†”æ–­å™¨
- âœ… å®Œå–„äº†ç¿»è¯‘å“åº”éªŒè¯
- âœ… ä¿®å¤äº†å‘åå…¼å®¹æ€§é—®é¢˜

#### å­˜å‚¨æ¨¡å—é”™è¯¯å¤„ç†å™¨
- âœ… å®ç°äº†å®‰å…¨çš„IndexedDBæ“ä½œåŒ…è£…å™¨
- âœ… æ·»åŠ äº†å­˜å‚¨ç©ºé—´æ¸…ç†ç­–ç•¥
- âœ… å®Œå–„äº†å­˜å‚¨å¥åº·æ£€æŸ¥
- âœ… ä¿®å¤äº†æœªä½¿ç”¨å‚æ•°çš„é—®é¢˜

#### ç½‘ç»œæ¨¡å—é”™è¯¯å¤„ç†å™¨
- âœ… å®ç°äº†å¢å¼ºç‰ˆçš„NetworkUtilsç±»
- âœ… æ·»åŠ äº†ç†”æ–­å™¨å’Œè¯·æ±‚ç»Ÿè®¡
- âœ… å®Œå–„äº†æ‰¹é‡è¯·æ±‚å¤„ç†
- âœ… å®ç°äº†ç½‘ç»œè¿æ¥æ£€æŸ¥

#### æ–‡ä»¶å¤„ç†é”™è¯¯å¤„ç†å™¨
- âœ… å®ç°äº†å¢å¼ºç‰ˆçš„æ–‡ä»¶éªŒè¯
- âœ… æ·»åŠ äº†ç¼–ç è‡ªåŠ¨æ£€æµ‹
- âœ… å®Œå–„äº†æ–‡ä»¶è§£æé”™è¯¯å¤„ç†
- âœ… ä¿®å¤äº†æœªä½¿ç”¨å˜é‡çš„é—®é¢˜

### 4. é”™è¯¯ç³»ç»Ÿé›†æˆå™¨

#### æ–°å¢åŠŸèƒ½ï¼š
- ğŸ†• åˆ›å»ºäº† `ErrorSystemIntegrator` ç±»
- ğŸ†• å®ç°äº†è‡ªåŠ¨åˆå§‹åŒ–å’Œä¾èµ–ç®¡ç†
- ğŸ†• æ·»åŠ äº†ç³»ç»Ÿå¥åº·æ£€æŸ¥
- ğŸ†• å®Œå–„äº†æ¨¡å—æ³¨å†Œå’Œé…ç½®

> è¯´æ˜ï¼š`ErrorSystemIntegrator` ä¸ `initializeErrorSystem(...)` ä½äº `public/app/core/error-integration.js`ï¼Œå¹¶æš´éœ²ä¸º
> `window.ErrorSystemIntegrator` / `window.initializeErrorSystem`ã€‚æ­¤å¤–ä»“åº“ç°çŠ¶ä¼šåˆ›å»ºå…¨å±€å®ä¾‹ `window.errorSystemIntegrator`ã€‚

#### è§£å†³çš„é—®é¢˜ï¼š
- âœ… è§£å†³äº†å¾ªç¯ä¾èµ–é—®é¢˜
- âœ… ç»Ÿä¸€äº†åˆå§‹åŒ–æµç¨‹
- âœ… è§„èŒƒäº†æ¨¡å—é—´é€šä¿¡
- âœ… æä¾›äº†ç³»ç»ŸçŠ¶æ€ç›‘æ§

### 5. æµ‹è¯•å’ŒéªŒè¯ç³»ç»Ÿ

#### æ–°å¢å†…å®¹ï¼š
- ğŸ†• åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- ğŸ†• å®ç°äº†è‡ªåŠ¨å¥åº·æ£€æŸ¥
- ğŸ†• æ·»åŠ äº†æ€§èƒ½ç›‘æ§
- ğŸ†• å®Œå–„äº†é”™è¯¯æŠ¥å‘Šæœºåˆ¶

## æŠ€æœ¯æ”¹è¿›

### 1. æ¶æ„ä¼˜åŒ–
```javascript
// ä¿®å¤å‰ï¼šå…¨å±€å˜é‡æ±¡æŸ“ï¼Œä¾èµ–ä¸æ¸…æ™°
window.errorManager = new ErrorManager();
showNotification(type, title, message); // å¯èƒ½æœªå®šä¹‰

// ä¿®å¤åï¼šä¾èµ–æ³¨å…¥ï¼Œæ¸…æ™°çš„åˆå§‹åŒ–æµç¨‹
const integrator = await window.initializeErrorSystem({
  notificationHandler: customNotificationHandler
});
```

### 2. é”™è¯¯å¤„ç†ç»Ÿä¸€
```javascript
// ä¿®å¤å‰ï¼šå„æ¨¡å—ä½¿ç”¨ä¸åŒçš„é”™è¯¯å¤„ç†æ¨¡å¼
function handleTranslationError(error) {
  console.error(error);
  showNotification('error', 'Error', error.message);
}

// ä¿®å¤åï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼
const standardError = errorManager.handleError(error, context);
// è‡ªåŠ¨åˆ†ç±»ã€é€šçŸ¥ã€æ¢å¤ã€ç»Ÿè®¡
```

### 3. é‡è¯•æœºåˆ¶å®Œå–„
```javascript
// ä¿®å¤å‰ï¼šç®€å•çš„é‡è¯•
for (let i = 0; i < 3; i++) {
  try {
    return await operation();
  } catch (error) {
    if (i === 2) throw error;
  }
}

// ä¿®å¤åï¼šæ™ºèƒ½çš„æŒ‡æ•°é€€é¿é‡è¯•
const retryStrategy = createRetryStrategy({
  maxRetries: 3,
  baseDelay: 1000,
  backoffFactor: 2,
  retryableErrors: [NETWORK_ERROR, TIMEOUT]
});
return await retryStrategy(operation, context);
```

### 4. æ‰¹é‡æ“ä½œä¼˜åŒ–
```javascript
// ä¿®å¤å‰ï¼šç®€å•çš„å¾ªç¯å¤„ç†
for (const item of items) {
  try {
    await processItem(item);
  } catch (error) {
    console.error(error);
  }
}

// ä¿®å¤åï¼šå®Œæ•´çš„æ‰¹é‡é”™è¯¯æ”¶é›†
const collector = new BatchErrorCollector();
for (const [index, item] of items.entries()) {
  const result = await safeAsync(() => processItem(item));
  if (result.success) {
    collector.addSuccess(index, result.data, item);
  } else {
    collector.addError(index, result.error, item);
  }
}
const summary = collector.getSummary();
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†
- âœ… å®ç°äº†é”™è¯¯å†å²çš„è‡ªåŠ¨æ¸…ç†
- âœ… ä¼˜åŒ–äº†äº‹ä»¶ç›‘å¬å™¨çš„æ¸…ç†æœºåˆ¶
- âœ… æ·»åŠ äº†å­˜å‚¨ç©ºé—´çš„å®šæœŸæ¸…ç†

### 2. ç½‘ç»œä¼˜åŒ–
- âœ… å®ç°äº†ç†”æ–­å™¨æ¨¡å¼ï¼Œé¿å…æ— æ•ˆè¯·æ±‚
- âœ… æ·»åŠ äº†è¯·æ±‚ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§
- âœ… ä¼˜åŒ–äº†æ‰¹é‡è¯·æ±‚çš„å¹¶å‘æ§åˆ¶

### 3. é”™è¯¯å¤„ç†æ€§èƒ½
- âœ… æ·»åŠ äº†é”™è¯¯å¤„ç†æ€§èƒ½ç›‘æ§
- âœ… ä¼˜åŒ–äº†é”™è¯¯åˆ†ç±»å’Œæ ‡å‡†åŒ–æµç¨‹
- âœ… å®ç°äº†é€šçŸ¥é˜Ÿåˆ—ï¼Œé¿å…é€šçŸ¥é£æš´

## å®‰å…¨å¢å¼º

### 1. APIå¯†é’¥éªŒè¯
```javascript
// ä¿®å¤å‰ï¼šåŸºæœ¬æ ¼å¼æ£€æŸ¥
if (!apiKey || apiKey.length < 10) {
  throw new Error('Invalid API key');
}

// ä¿®å¤åï¼šå®Œæ•´çš„å®‰å…¨éªŒè¯
function validateApiKey(apiKey, engine) {
  // 1. æ£€æŸ¥æ˜¯å¦ä¸ºç©º
  // 2. æ£€æŸ¥æ ¼å¼
  // 3. æ£€æŸ¥é•¿åº¦
  // 4. ä¸åœ¨é”™è¯¯æ¶ˆæ¯ä¸­æš´éœ²å¯†é’¥
  // 5. è€ƒè™‘æ·»åŠ è¿‡æœŸæ£€æŸ¥
}
```

### 2. æ–‡ä»¶å®‰å…¨
```javascript
// ä¿®å¤å‰ï¼šåŸºæœ¬æ–‡ä»¶åæ£€æŸ¥
if (fileName.includes('/')) {
  throw new Error('Invalid filename');
}

// ä¿®å¤åï¼šå…¨é¢çš„å®‰å…¨æ£€æŸ¥
function validateFileName(fileName) {
  // 1. æ£€æŸ¥å±é™©å­—ç¬¦
  // 2. æ£€æŸ¥è·¯å¾„éå†æ”»å‡»
  // 3. æ£€æŸ¥éšè—æ–‡ä»¶
  // 4. æ£€æŸ¥é•¿åº¦é™åˆ¶
  // 5. æ£€æŸ¥ä¿ç•™åç§°
}
```

## å…¼å®¹æ€§ä¿è¯

### 1. å‘åå…¼å®¹
- âœ… ä¿ç•™äº†åŸæœ‰çš„å‡½æ•°æ¥å£
- âœ… æä¾›äº†æ¸è¿›å¼å‡çº§è·¯å¾„
- âœ… ç»´æŠ¤äº†ç°æœ‰çš„è°ƒç”¨æ–¹å¼

### 2. æ¸è¿›å¼å¢å¼º
```javascript
// åŸæœ‰ä»£ç ç»§ç»­å·¥ä½œ
formatTranslationError(error, engine);

// æ–°ä»£ç å¯ä»¥ä½¿ç”¨å¢å¼ºåŠŸèƒ½
TranslationErrorHandler.formatTranslationErrorV2(error, engine);
```

## æµ‹è¯•è¦†ç›–

### 1. å•å…ƒæµ‹è¯•
- âœ… é”™è¯¯åˆ›å»ºå’Œåˆ†ç±»æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤æµ‹è¯•
- âœ… å·¥å…·å‡½æ•°æµ‹è¯•
- âœ… æ¨¡å—é›†æˆæµ‹è¯•

### 2. é›†æˆæµ‹è¯•
- âœ… ç«¯åˆ°ç«¯é”™è¯¯å¤„ç†æµç¨‹æµ‹è¯•
- âœ… æ¨¡å—é—´é€šä¿¡æµ‹è¯•
- âœ… æ€§èƒ½å’Œå†…å­˜æµ‹è¯•
- âœ… å…¼å®¹æ€§æµ‹è¯•

### 3. å¥åº·æ£€æŸ¥
```javascript
// å¿«é€Ÿå¥åº·æ£€æŸ¥
const health = quickHealthCheck();
console.log('ç³»ç»ŸçŠ¶æ€:', health.status);

// å®Œæ•´æµ‹è¯•å¥—ä»¶
const testResult = await runErrorSystemTest();
console.log('æµ‹è¯•é€šè¿‡ç‡:', testResult.summary.passRate);
```

## ä½¿ç”¨æŒ‡å—

### 1. åŸºæœ¬ä½¿ç”¨
```javascript
// åˆ›å»ºé”™è¯¯
const error = errorManager.createError(ERROR_CODES.NETWORK_ERROR, 'ç½‘ç»œè¿æ¥å¤±è´¥');

// å¤„ç†é”™è¯¯
const handledError = errorManager.handleError(error, { operation: 'fetchData' });

// å®‰å…¨æ‰§è¡Œå¼‚æ­¥æ“ä½œ
const result = await safeAsync(asyncOperation, {
  retryCount: 3,
  context: { operation: 'translation' }
});
```

### 2. æ‰¹é‡æ“ä½œ
```javascript
const collector = new BatchErrorCollector();
const results = await handleBatchTranslation(items, engine, translateFn, onProgress);
console.log('æ‰¹é‡æ“ä½œç»“æœ:', results.summary);
```

### 3. ç³»ç»Ÿç›‘æ§
```javascript
// è·å–é”™è¯¯ç»Ÿè®¡
const stats = errorManager.getErrorStats();

// è·å–ç³»ç»ŸçŠ¶æ€
const status = window.errorSystemIntegrator.getSystemStatus();

// å¯¼å‡ºé”™è¯¯æ—¥å¿—
errorManager.exportErrorLog();
```

## éƒ¨ç½²å»ºè®®

### 1. å¼€å‘ç¯å¢ƒ
- å¯ç”¨å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- å¼€å¯è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- ä½¿ç”¨å¼€å‘æ¨¡å¼çš„é”™è¯¯å¤„ç†å™¨

### 2. ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨ç²¾ç®€ç‰ˆçš„é”™è¯¯å¤„ç†å™¨
- å¯ç”¨é”™è¯¯æŠ¥å‘Šå’Œç›‘æ§
- é…ç½®é€‚å½“çš„æ—¥å¿—çº§åˆ«

### 3. ç›‘æ§å’Œç»´æŠ¤
- å®šæœŸæ£€æŸ¥é”™è¯¯ç»Ÿè®¡
- ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- åŠæ—¶å¤„ç†é”™è¯¯æŠ¥å‘Š

## æ€»ç»“

æœ¬æ¬¡ä¿®å¤å…¨é¢è§£å†³äº†é”™è¯¯å¤„ç†ç³»ç»Ÿçš„ä¸å®Œæ•´é—®é¢˜ï¼Œå®ç°äº†ï¼š

1. **å®Œæ•´æ€§**ï¼šæ‰€æœ‰æœªå®ç°çš„æ–¹æ³•éƒ½å·²å®Œæˆ
2. **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€äº†æ‰€æœ‰æ¨¡å—çš„é”™è¯¯å¤„ç†æ¨¡å¼
3. **å¯é æ€§**ï¼šæ·»åŠ äº†å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯æœºåˆ¶
4. **æ€§èƒ½**ï¼šä¼˜åŒ–äº†å†…å­˜ä½¿ç”¨å’Œå¤„ç†æ•ˆç‡
5. **å®‰å…¨æ€§**ï¼šå¢å¼ºäº†è¾“å…¥éªŒè¯å’Œé”™è¯¯ä¿¡æ¯ä¿æŠ¤
6. **å¯ç»´æŠ¤æ€§**ï¼šæä¾›äº†æ¸…æ™°çš„æ¶æ„å’Œæ–‡æ¡£

é”™è¯¯å¤„ç†ç³»ç»Ÿç°åœ¨å·²ç»æˆä¸ºä¸€ä¸ªå®Œæ•´ã€å¯é ã€é«˜æ€§èƒ½çš„ç»Ÿä¸€é”™è¯¯ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚